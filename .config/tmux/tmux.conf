# ╔═════════════════════════════════════════╗
# ║                                         ║
# ║  ████████╗███╗   ███╗██╗   ██╗██╗  ██╗  ║
# ║  ╚══██╔══╝████╗ ████║██║   ██║╚██╗██╔╝  ║
# ║     ██║   ██╔████╔██║██║   ██║ ╚███╔╝   ║
# ║     ██║   ██║╚██╔╝██║██║   ██║ ██╔██╗   ║
# ║     ██║   ██║ ╚═╝ ██║╚██████╔╝██╔╝ ██╗  ║
# ║     ╚═╝   ╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═╝  ║
# ║                                         ║
# ╚═════════════════════════════════════════╝

# ===========================================
# General Configuration
# ===========================================

# Enable mouse
set -g mouse on

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1

# Auto-renumber windows (closing window re-indexes existing windows to their new numbers)
set -g renumber-windows on

# Enable system clipboard
set -g set-clipboard on 

# Massive scrollback buffer
set -g history-limit 1000000

# 1 second repeat window
set -g repeat-time 1000

# Remove delay in nvim/vim when hitting Esc in editor
set -s escape-time 0

# ===========================================
# Key Bindings
# ===========================================

# Set prefix, r to reload .tmux.config
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display "󰁯 Config reloaded!"

# Set prefix to ctrl + space (default: ctrl + b)
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# Open new panes in current directory (using - and |)
unbind '"' # default split window vertically
unbind %   # default split window horizontally
bind - split-window -v -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"

# Open new windows in current directory
bind c new-window -c "#{pane_current_path}"

# Navigate panes via vim-motion
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# Resize panes with vim-motion
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ===========================================
# Plugins
# ===========================================
set -g @plugin "tmux-plugins/tpm"
set -g @plugin "tmux-plugins/tmux-battery"
set -g @plugin "tmux-plugins/tmux-online-status"
set -g @plugin "tmux-plugins/tmux-resurrect"
set -g @plugin "tmux-plugins/tmux-continuum"
set -g @plugin "tmux-plugins/tmux-sensible"
set -g @plugin "tmux-plugins/tmux-yank"
set -g @plugin "aaronpowell/tmux-weather"

# [tmux-battery]
set -g @batt_icon_charge_tier8 "󰁹"
set -g @batt_icon_charge_tier7 "󰂁"
set -g @batt_icon_charge_tier6 "󰁿"
set -g @batt_icon_charge_tier5 "󰁾"
set -g @batt_icon_charge_tier4 "󰁽"
set -g @batt_icon_charge_tier3 "󰁼"
set -g @batt_icon_charge_tier2 "󰁻"
set -g @batt_icon_charge_tier1 "󰁺"
set -g @batt_icon_status_charged "󰚥"
set -g @batt_icon_status_charging "󰂄"
set -g @batt_icon_status_discharging "󰂃"
set -g @batt_icon_status_unknown "󰂑"
set -g @batt_icon_status_attached "󰂄"

# [tmux-online-status]
set -g @online_icon "online"
set -g @offline_icon "offline"

# [tmux-continuum] automatically resurrect tmux environment after system restart
set -g @continuum-restore "on"
set -g @continuum-save-interval "15" # save every 15 minutes

# [tmux-yank] Set vi-mode
set -g mode-keys vi
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# [tmux-weather]
set -g @forecast-format "%t"
set -g @forecast-units "m"
set -g @forecast-cache-duration 900
set -g @forecast-char-limit 8

# ===========================================
# Visual Improvements
# ===========================================

# Tokyo Night colors
set -g @thm_bg "#1a1b26"
set -g @thm_bg_highlight "#24283b"
set -g @thm_gray "#414868"
set -g @thm_red "#f7768e"
set -g @thm_orange "#ff9e64"
set -g @thm_yellow "#e0af68"
set -g @thm_green "#9ece6a"
set -g @thm_teal "#73daca"
set -g @thm_blue "#7aa2f7"
set -g @thm_purple "#bb9af7"
set -g @thm_white "#c0caf5"

# tmux-battery colors
set -g @batt_color_status_primary_charged "#{@thm_green}"
set -g @batt_color_status_primary_charging "#{@thm_teal}"

# Set true colors
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",tmux-256color:Tc,screen-256color:Tc,xterm-256color:Tc"
set -sa terminal-features ",tmux-256color:RGB,screen-256color:RGB,xterm-256color:RGB"

# check status every x seconds
set -g status-interval 5

# status left look and feel
set -g status-left-length 100
set -g status-left ""
set -ga status-left "#{?client_prefix,#{#[bg=#{@thm_red},fg=#{@thm_bg},bold]  #S },#{?pane_in_mode,#{#[bg=#{@thm_yellow},fg=#{@thm_bg},bold]  #S },#{#[bg=#{@thm_bg},fg=#{@thm_teal}]  #S }}}"
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_gray},none]│"
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_purple}]  #{pane_current_command} "
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_gray},none]│"
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_blue}]  #{=/-32/...:#{s|$USER|~|:#{b:pane_current_path}}} "
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_gray},none]#{?window_zoomed_flag,│,}"
set -ga status-left "#[bg=#{@thm_bg},fg=#{@thm_yellow}]#{?window_zoomed_flag,  zoom ,}"

# status right look and feel
set -g status-right-length 100
set -g status-right ""
set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_yellow}]  #{forecast} "
set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_gray},none]│"
set -ga status-right "#[bg=#{@thm_bg}]#{?#{==:#{online_status},online},#[fg=#{@thm_white}] 󰖩 on ,#[bg=#{@thm_white}]#[fg=#{@thm_bg}]#[bold] 󰖪 off }"
set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_gray},none]│"
set -ga status-right "#{?#{e|<=:#{battery_percentage},10},#{#[bg=#{@thm_red},fg=#{@thm_bg}]},#{#[bg=#{@thm_bg},fg=#{@thm_green}]}} #{battery_icon} #{battery_percentage} "
set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_gray},none]│"
set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_blue}] 󰭦 %m/%d/%y 󰅐 %H:%M "

# other look and feel
set -g status-position top
set -g status-style "bg=#{@thm_bg}"
set -g status-justify "absolute-centre"

# pane border look and feel
set -g pane-border-status top
set -g pane-border-format ""
set -g pane-active-border-style "bg=#{@thm_bg},fg=#{@thm_gray}"
set -g pane-border-style "bg=#{@thm_bg},fg=#{@thm_bg_highlight}"
set -g pane-border-lines single

# window look and feel
set -g automatic-rename on
set -g automatic-rename-format "Window"

set -g window-status-format " #I#{?#{!=:#{window_name},Window},: #W,} "
set -g window-status-style "bg=#{@thm_bg_highlight},fg=#{@thm_white}"
set -g window-status-last-style "bg=#{@thm_bg_highlight},fg=#{@thm_orange}"
set -g window-status-activity-style "bg=#{@thm_red},fg=#{@thm_bg}"
set -g window-status-bell-style "bg=#{@thm_red},fg=#{@thm_bg},bold"
set -gF window-status-separator "#[bg=#{@thm_bg},fg=#{@thm_gray}]│"

set -g window-status-current-format " #I#{?#{!=:#{window_name},Window},: #W,} "
set -g window-status-current-style "bg=#{@thm_orange},fg=#{@thm_bg},bold"

# Initialize TMUX plugin manager (keep this line at the very bottom of the .tmux.conf)
run "~/.config/tmux/plugins/tpm/tpm"
